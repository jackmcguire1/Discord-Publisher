import{Q as Y,R as G,U as V,V as _,y as k,c as D,I as A,j as e,W,X as T,Y as P,Z as X,k as O,$ as Z,v as E,E as C,a as M,r as g,m as L,a0 as z,a1 as B,a2 as H,T as S,a3 as J,a4 as K,w as I,a5 as ee,a6 as te,t as se,g as ne,a7 as ae,a8 as oe,f as U,L as ie}from"./main-c3456b93.js";import{S as ce}from"./index-7c1b25ef.js";import{a as le}from"./PremiumSuggest-0d821a06.js";import{p as $}from"./index-e4f144c6.js";const Q=i=>Y()(G(V((n,m)=>({actions:{},clear:()=>n({actions:{}}),setActionSet:(c,s)=>n(t=>{t.actions[c]=s}),addAction:(c,s)=>n(t=>{const a=t.actions[c];a?a.actions.push(s):t.actions[c]={actions:[s]}}),clearActions:c=>n(s=>{const t=s.actions[c];t&&(t.actions=[])}),deleteAction:(c,s)=>n(t=>{const a=t.actions[c];a&&a.actions.splice(s,1)}),moveActionUp:(c,s)=>n(t=>{const a=t.actions[c];if(a){const l=a.actions[s];l&&(a.actions.splice(s,1),a.actions.splice(s-1,0,l))}}),moveActionDown:(c,s)=>{n(t=>{const a=t.actions[c];if(a){const l=a.actions[s];l&&(a.actions.splice(s,1),a.actions.splice(s+1,0,l))}})},duplicateAction:(c,s)=>{n(t=>{const a=t.actions[c];if(a){const l=a.actions[s];l&&a.actions.splice(s+1,0,{...l,id:_()})}})},setActionType:(c,s,t)=>n(a=>{const l=a.actions[c],o=l.actions[s];t===1||t===6||t===8?l.actions[s]={type:t,id:o.id,text:"",public:!1,allow_role_mentions:!1}:t===5||t===7||t===9?l.actions[s]={type:t,id:o.id,target_id:"",public:!1,allow_role_mentions:!1}:t===2||t===3||t===4?l.actions[s]={type:t,id:o.id,target_id:"",public:!1,disable_default_response:!1,allow_role_mentions:!1}:t===10&&(l.actions[s]={type:t,id:o.id,permissions:"0",role_ids:[],disable_default_response:!1})}),setActionText:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];(o.type===1||o.type===6||o.type===8||o.type===10&&o.disable_default_response)&&(o.text=t)}),setActionTargetId:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];(o.type===2||o.type===3||o.type===4||o.type===5||o.type===7||o.type===9)&&(o.target_id=t)}),setActionPublic:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];o.type!==10&&(o.public=t)}),setActionAllowRoleMentions:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];o.type!==10&&(o.allow_role_mentions=t)}),setActionDisableDefaultResponse:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];(o.type===2||o.type===3||o.type===4||o.type===10)&&(o.disable_default_response=t)}),setActionPermissions:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];o.type===10&&(o.permissions=t)}),setActionRoleIds:(c,s,t)=>n(a=>{const o=a.actions[c].actions[s];o.type===10&&(o.role_ids=t)})}),{name:i,version:0})));Q("current-message-actions");const v=Q("custom-commands-actions");function re({cmdId:i,actionIndex:n}){const m=k(),c=(m==null?void 0:m.max_actions_per_component)||0,s=D(r=>r.guildId),t=v(r=>{var w;return(w=r.actions[i])==null?void 0:w.actions[n]},A),a=v(r=>{var w,R;return((R=(w=r.actions[i])==null?void 0:w.actions)==null?void 0:R.length)||0}),[l,o,h,b]=v(r=>[r.moveActionUp,r.moveActionDown,r.duplicateAction,r.deleteAction],A),[f,j,d,x,y,u,N,p]=v(r=>[r.setActionType,r.setActionText,r.setActionTargetId,r.setActionPublic,r.setActionAllowRoleMentions,r.setActionDisableDefaultResponse,r.setActionRoleIds,r.setActionPermissions],A);return e.jsx(W,{guildId:s,actionCount:a,maxActions:c,actionIndex:n,action:t,collapsableId:`actions.${i}.actions.${t.id}`,moveUp:()=>l(i,n),moveDown:()=>o(i,n),duplicate:()=>h(i,n),remove:()=>b(i,n),setText:r=>j(i,n,r),setType:r=>f(i,n,r),setTargetId:r=>d(i,n,r),setPublic:r=>x(i,n,r),setAllowRoleMentions:r=>y(i,n,r),setDisableDefaultResponse:r=>u(i,n,r),setRoleIds:r=>N(i,n,r),setPermissions:r=>p(i,n,r)})}function q({cmdId:i}){const n=k(),m=(n==null?void 0:n.max_actions_per_component)||0,c=v(l=>{var o;return((o=l.actions[i])==null?void 0:o.actions.map(h=>h.id))||[]},A),[s,t]=v(l=>[l.addAction,l.clearActions],A);function a(){s(i,{id:_(),type:1,text:"",public:!1,allow_role_mentions:!1})}return e.jsxs(T,{id:`actions.${i}`,validationPathPrefix:`actions.${i}`,title:"Actions",extra:e.jsxs("div",{className:"text-sm italic font-light text-gray-400",children:[c.length," / ",m]}),children:[e.jsx(P,{className:"space-y-2",children:c.map((l,o)=>e.jsx(re,{cmdId:i,actionIndex:o},l))}),e.jsxs("div",{className:"space-x-3 mt-3 text-sm",children:[c.length<m?e.jsx("button",{className:"bg-blurple px-3 py-2 rounded transition-colors hover:bg-blurple-dark text-white",onClick:a,children:"Add Action"}):e.jsx("button",{disabled:!0,className:"bg-dark-2 px-3 py-2 rounded transition-colors cursor-not-allowed text-gray-300",children:"Add Action"}),e.jsx("button",{className:"px-3 py-2 rounded border-2 border-red hover:bg-red transition-colors text-white",onClick:()=>t(i),children:"Clear Actions"})]})]})}function de({cmdId:i,parameters:n,parameterIndex:m,maxParameters:c,setParameters:s}){const t=n[m];function a(){const d=[...n];d.splice(m-1,0,d.splice(m,1)[0]),s(d)}function l(){const d=[...n];d.splice(m+1,0,d.splice(m,1)[0]),s(d)}function o(){const d=[...n];d.splice(m,0,{...t,id:_()}),s(d)}function h(){const d=[...n];d.splice(m,1),s(d)}function b(d){const x=[...n];x[m].type=parseInt(d),s(x)}function f(d){const x=[...n];x[m].name=d,s(x)}function j(d){const x=[...n];x[m].description=d,s(x)}return e.jsx("div",{className:"p-3 border-2 border-dark-6 rounded-md",children:e.jsx(T,{id:`command.${i}.parameters.${t.id}`,title:`Argument ${m+1}`,buttons:e.jsxs("div",{className:"flex-none text-gray-300 flex items-center space-x-2",children:[m>0&&e.jsx(X,{className:"h-6 w-6 flex-none",role:"button",onClick:a}),m<n.length-1&&e.jsx(O,{className:"h-6 w-6 flex-none",role:"button",onClick:l}),n.length<c&&e.jsx(Z,{className:"h-5 w-5 flex-none",role:"button",onClick:o}),e.jsx(E,{className:"h-5 w-5 flex-none",role:"button",onClick:h})]}),extra:t.name?e.jsxs("div",{className:"text-gray-500 truncate flex space-x-2 pl-2",children:[e.jsx("div",{children:"-"}),e.jsx("div",{className:"truncate",children:t.name})]}):null,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col space-y-3 lg:flex-row lg:space-x-3 lg:space-y-0",children:e.jsxs("div",{className:"flex-none",children:[e.jsx("div",{className:"mb-1.5 flex",children:e.jsx("div",{className:"uppercase text-gray-300 text-sm font-medium",children:"Type"})}),e.jsxs("select",{className:"bg-dark-2 rounded p-2 w-full no-ring font-light cursor-pointer text-white",value:t.type.toString(),onChange:d=>b(d.target.value),children:[e.jsx("option",{value:"3",children:"Text"}),e.jsx("option",{value:"4",children:"Whole Number"}),e.jsx("option",{value:"10",children:"Decimal Number"}),e.jsx("option",{value:"5",children:"True / False"}),e.jsx("option",{value:"6",children:"User"}),e.jsx("option",{value:"7",children:"Channel"}),e.jsx("option",{value:"8",children:"Role"}),e.jsx("option",{value:"11",children:"File"})]})]})}),e.jsx(C,{label:"Name",type:"text",maxLength:32,value:t.name,onChange:f}),e.jsx(C,{label:"Description",type:"text",maxLength:100,value:t.description,onChange:j})]})})})}function F({cmdId:i,parameters:n,setParameters:m}){function s(){m([...n,{id:_(),name:"",description:"",type:3}])}return e.jsxs(T,{id:`command.${i}.parameters`,validationPathPrefix:`actions.${i}`,title:"Arguments",extra:e.jsxs("div",{className:"text-sm italic font-light text-gray-400",children:[n.length," / ",5]}),children:[e.jsx(P,{className:"space-y-2",children:n.map((t,a)=>e.jsx(de,{cmdId:i,parameterIndex:a,parameters:n,setParameters:m,maxParameters:5,parameterCount:n.length},t.id))}),e.jsxs("div",{className:"space-x-3 mt-3 text-sm",children:[n.length<5?e.jsx("button",{className:"bg-blurple px-3 py-2 rounded transition-colors hover:bg-blurple-dark text-white",onClick:s,children:"Add Parameter"}):e.jsx("button",{disabled:!0,className:"bg-dark-2 px-3 py-2 rounded transition-colors cursor-not-allowed text-gray-300",children:"Add Parameter"}),e.jsx("button",{className:"px-3 py-2 rounded border-2 border-red hover:bg-red transition-colors text-white",onClick:()=>m([]),children:"Clear Parameter"})]})]})}function me({cmd:i}){const n=D(p=>p.guildId),m=M(p=>p.create),[c,s]=g.useState(!1),[t,a]=g.useState(i.name),[l,o]=g.useState(i.description),[h,b]=g.useState(i.parameters),f=L(),j=z();g.useEffect(()=>{const p=B.safeParse(i.actions);p.success&&v.getState().setActionSet(i.id,p.data)},[i.actions]);function d(){if(t.length==0||l.length==0)return;const p=v.getState().actions[i.id];j.mutate({guildId:n,commandId:i.id,req:{name:t,description:l,enabled:!0,parameters:h,actions:p||null}},{onSuccess(r){r.success?(s(!1),f.invalidateQueries(["custom-bot",n,"commands"])):m({title:"Failed to update command",message:r.error.message,type:"error"})}})}const x=H(),[y,u]=g.useState(!1);function N(){x.mutate({commandId:i.id,guildId:n},{onSuccess:p=>{p.success?f.invalidateQueries(["custom-bot",n,"commands"]):m({title:"Failed to delete command",message:p.error.message,type:"error"})}})}return e.jsxs("div",{children:[e.jsx(P,{className:"bg-dark-3 rounded",children:c?e.jsxs("div",{className:"px-5 py-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex items-center space-x-2 truncate text-lg mb-5",children:e.jsxs("div",{className:"text-white truncate",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xl",children:"/"})," ",i.name]})}),e.jsxs("div",{className:"flex items-center text-white cursor-pointer bg-blurple hover:bg-blurple-dark rounded px-2 py-1",role:"button",onClick:d,children:[e.jsx(S,{text:"Save Command",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs("div",{className:"ml-2",children:["Save ",e.jsx("span",{className:"hidden md:inline-block",children:"Changes"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(C,{label:"Name",type:"text",maxLength:32,value:t,onChange:a}),e.jsx(C,{label:"Description",type:"text",maxLength:100,value:l,onChange:o}),e.jsx(F,{parameters:h||[],setParameters:b,cmdId:i.id}),e.jsx(q,{cmdId:i.id})]})]},"1"):e.jsxs("div",{className:"flex justify-between items-start py-4 px-5",children:[e.jsxs("div",{className:"flex-auto truncate",children:[e.jsx("div",{className:"flex items-center space-x-2 truncate text-lg mb-1",children:e.jsxs("div",{className:"text-white truncate",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xl",children:"/"})," ",i.name]})}),e.jsx("div",{className:"text-gray-400 text-sm font-light whitespace-normal",children:i.description})]}),e.jsxs("div",{className:"flex flex-none items-center space-x-4 md:space-x-3",children:[e.jsxs("div",{className:"flex items-center text-gray-300 hover:text-white cursor-pointer md:bg-dark-2 md:rounded md:px-2 md:py-1",role:"button",onClick:()=>u(!0),children:[e.jsx(S,{text:"Delete Command",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("div",{className:"hidden md:block ml-2",children:"Delete"})]}),e.jsxs("div",{className:"flex items-center text-gray-300 hover:text-white cursor-pointer md:bg-dark-2 md:rounded md:px-2 md:py-1",role:"button",onClick:()=>s(!0),children:[e.jsx(S,{text:"Manage Command",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsx("div",{className:"hidden md:block ml-2",children:"Manage"})]})]})]},"2")}),y&&e.jsx(I,{title:"Are you sure that you want to delete the command?",subTitle:"The command will be deleted permanently and can't be restored.",onClose:()=>u(!1),onConfirm:N})]})}function ue({setCreate:i,cancelable:n}){const m=D(d=>d.guildId),c=M(d=>d.create),[s,t]=g.useState(""),[a,l]=g.useState(""),[o,h]=g.useState([]),b=L(),f=ee();function j(){if(s.length==0||a.length==0||!m)return;const d=v.getState().actions.new;f.mutate({guildId:m,req:{name:s,description:a,parameters:o,actions:d||null}},{onSuccess:x=>{x.success?(t(""),l(""),i(!1),b.invalidateQueries(["custom-bot",m,"commands"])):c({title:"Failed to create command",message:x.error.message,type:"error"})}})}return e.jsxs("div",{className:"bg-dark-3 p-5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 truncate text-lg mb-5 justify-between",children:[e.jsxs("div",{className:"text-white truncate",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xl",children:"/"})," ",s]}),e.jsxs("div",{className:"flex flex-none items-center space-x-4 md:space-x-3",children:[n&&e.jsxs("div",{className:"flex items-center text-gray-300 hover:text-white cursor-pointer md:bg-dark-2 md:rounded md:px-2 md:py-1",role:"button",onClick:()=>i(!1),children:[e.jsx(S,{text:"Cancel",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx("div",{className:"hidden md:block ml-2",children:"Cancel"})]}),e.jsxs("div",{className:"flex items-center text-white cursor-pointer bg-blurple hover:bg-blurple-dark rounded px-2 py-1",role:"button",onClick:j,children:[e.jsx(S,{text:"Create Custom Command",children:e.jsx(se,{className:"h-5 w-5"})}),e.jsxs("div",{className:"ml-2",children:["Create ",e.jsx("span",{className:"hidden md:inline-block",children:"Command"})]})]})]})]}),e.jsxs("div",{className:"space-y-5 mb-5",children:[e.jsx(C,{label:"Name",type:"text",maxLength:32,value:s,onChange:t}),e.jsx(C,{label:"Description",type:"text",maxLength:100,value:a,onChange:l}),e.jsx(F,{parameters:o||[],setParameters:h,cmdId:"new"}),e.jsx(q,{cmdId:"new"})]})]})}function ge(){var x,y;const{data:i}=ne(),n=M(u=>u.create),[m,c]=g.useState(!1),s=D(u=>u.guildId),t=k(),a=ae(s),l=(x=a.data)!=null&&x.success?a.data.data.length:0,o=k(s),h=(o==null?void 0:o.max_custom_commands)||0,b=oe(),f=((y=a.data)==null?void 0:y.success)&&a.data.data.some(u=>!u.deployed_at||$(u.updated_at)>$(u.deployed_at));function j(){!s||!f||b.mutate({guildId:s},{onSuccess:u=>{u.success?a.refetch():n({title:"Failed to deploy commands",message:u.error.message,type:"error"})}})}const d=g.useMemo(()=>{var N;if(!((N=a.data)!=null&&N.success))return[];const u=a.data.data;return u.sort((p,r)=>p.name.localeCompare(r.name)),u},[a.data]);return e.jsx("div",{className:"overflow-y-auto w-full",children:e.jsxs("div",{className:"flex flex-col max-w-5xl mx-auto px-4 w-full my-5 lg:my-20",children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("div",{className:"text-white font-medium mb-3 flex items-center space-x-3",children:[e.jsx(ce,{className:"h-7 w-7 text-yellow"}),e.jsx("div",{className:"text-2xl",children:"Custom Commands"}),e.jsxs("div",{className:"font-light italic text-gray-400 flex-none",children:[l," / ",h]})]}),e.jsx("div",{className:"text-gray-400 font-light text-sm",children:"You can create custom commands to add more functionality to your custom bot. You need to configure a custom bot first which is available to servers with premium in the settings."})]}),i!=null&&i.success?t!=null&&t.max_custom_commands?e.jsxs("div",{className:"space-y-5 mb-8",children:[e.jsxs(P,{className:"space-y-5 overlfow-y-auto",children:[d.map(u=>e.jsx(me,{cmd:u},u.id)),(d.length===0||m)&&e.jsx(ue,{setCreate:c,cancelable:d.length!==0})]}),e.jsxs("div",{className:"flex space-x-3 justify-end",children:[e.jsx("button",{className:U("px-3 py-2 rounded text-white",f?"bg-blurple hover:bg-blurple-dark":"bg-dark-2 cursor-not-allowed"),onClick:j,children:"Deploy Commands"}),e.jsx("button",{className:U("px-3 py-2 rounded border-2 text-white",d.length<h?"border-dark-7 hover:bg-dark-6 cursor-pointer":"border-dark-6 text-gray-300 cursor-not-allowed"),onClick:()=>d.length<h&&c(!0),children:"New Command"})]})]}):e.jsx(le,{alwaysExpanded:!0}):e.jsx(ie,{alwaysExpanded:!0})]})})}export{ge as default};
